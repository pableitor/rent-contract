

<!DOCTYPE html>
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrato de Alojamiento Temporal</title>
  <link href="styles/style.css" rel="stylesheet" type="text/css" />
  
  <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/aws-sdk@2.1414.0/dist/aws-sdk.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script type="text/javascript" src="html2canvas.js"></script>
</head>
<body>
<div style="max-width: 800px; margin: auto; margin-bottom: 20px; text-align: center;">
  <label for="reservaId"><strong>Codigo Reserva Airbnb:</strong></label>
  <input type="text" id="reservaId"  style="margin-left: 10px; padding: 6px; width: 250px;">
  <button onclick="abrirReserva()" style="margin-left: 10px; padding: 6px 12px;">🔍 Abrir</button>
  <button onclick="importarDesdeClipboard()" style="margin-left: 10px; padding: 6px 12px;">📥 Importar datos</button>
</div>
<div class="contract-container" id="contrato">
  <h1>CONTRATO DE ARRENDAMIENTO DE ESTANCIAS TEMPORALES NO VACACIONALES</h1>
  <p style="text-align:right;">En Madrid, a <input type="date" class="placeholder" id="fechaContrato"></p>

  <h2>REUNIDOS</h2>
  <div class="party-info">
    <p>
      <strong>De una parte, D./D.ª Nina Dong</strong>, mayor de edad, con domicilio en Rd. Calabasa 11 , 28043 Madrid , y con NIF  05298495P , en adelante, la <strong>Parte Arrendadora</strong>.
    </p>
  </div>
  <div class="party-info">
    <p>
      <strong>Y de otra, D./D.ª <input type="text" class="placeholder" id="guestname" maxlength="50"></strong>,
       mayor de edad, con domicilio en <input type="text" class="placeholder full-width-input" id="guestaddress" maxlength="100">,
        y con NIF/PASAPORTE <input type="text" class="placeholder"  maxlength="25">, en adelante, la <strong>Parte Arrendataria</strong>.
    </p>
  </div>
  <p>Ambas partes, reconociéndose capacidad legal suficiente, acuerdan formalizar el presente contrato de arrendamiento de corta duración, con sujeción a las siguientes:</p>
  
  <h2>CLÁUSULAS</h2>
  
  <h3>Primera. Objeto del contrato</h3>
  <p>La Parte Arrendadora cede en arrendamiento a la Parte Arrendataria, quien acepta, la unidad de alojamiento ubicada en:</p>
 <input type="text" class="placeholder full-width-input" id="alojamiento" maxlength="100">
  
  <h3>Segunda. Finalidad temporal del arrendamiento</h3>
  <p>El arrendamiento tiene carácter temporal y no permanente, destinado a:</p>
  <div class="purpose-list">
    <div class="purpose-option">
        <input type="radio" id="purpose-trabajo" name="purpose" value="Trabajo temporal"><label for="purpose-trabajo">Trabajo temporal</label>
    </div>
    <div class="purpose-option">
        <input type="radio" id="purpose-estudios" name="purpose" value="Estudios"><label for="purpose-estudios">Estudios</label>
    </div>
    <div class="purpose-option">
        <input type="radio" id="purpose-medico" name="purpose" value="Tratamiento médico"><label for="purpose-medico">Tratamiento médico</label>
    </div>
    <div class="purpose-option">
        <input type="radio" id="purpose-personal" name="purpose" value="Motivos personales / familiares"><label for="purpose-personal">Motivos personales / familiares</label>
    </div>
    <div class="purpose-option">
        <input type="radio" id="purpose-otros" name="purpose" value="Otros">
        <label for="purpose-otros">
            Otros
            <input type="text" id="purpose-otros-details" class="placeholder"  maxlength="50">
        </label>
    </div>
  </div>
  <p>Conforme al artículo 3 de la Ley de Arrendamientos Urbanos, este contrato no se rige por las disposiciones aplicables al arrendamiento de vivienda habitual.</p>
  
  <h3>Tercera. Duración</h3>
  <p>El presente contrato tendrá una duración desde el día <input type="date" class="placeholder" id="fechaInicio"> hasta el día <input type="date" class="placeholder" id="fechaFin">, sin posibilidad de prórroga tácita, salvo acuerdo expreso.</p>
  
  <h3>Cuarta. Renta y forma de pago</h3>
  <p>El precio del arrendamiento ha sido acordado y satisfecho íntegramente a través de la plataforma digital AIRBNB.</p>
  <p>Dicha plataforma incluye tasas e impuestos en la gestión del pago. Las partes reconocen haber aceptado las condiciones económicas en dicha plataforma.</p>
  
  <h3>Quinta. Fianza</h3>
  <p>Al tratarse del arrendamiento temporal de una habitación ubicada dentro de la vivienda habitual de la parte arrendadora, las partes acuerdan no establecer fianza alguna.</p>
  <p>Esta exención se realiza conforme al carácter temporal del arrendamiento y la naturaleza del uso compartido del inmueble, en ejercicio de la libertad contractual reconocida por la normativa civil vigente.</p>
  
  <h3>Sexta. Uso y conservación</h3>
  <p>El arrendatario usará el alojamiento exclusivamente como vivienda temporal, sin realizar actividades molestas o ilegales.</p>
  
  <h3>Séptima. Protección de datos personales</h3>
  <p>En cumplimiento del RGPD y LOPDGDD, se informa que los datos personales se tratarán para la gestión del arrendamiento y podrán comunicarse al Registro y la Ventanilla Única Digital. El arrendatario podrá ejercer sus derechos de protección de datos.</p>
  
  <h3>Octava. Legislación aplicable</h3>
  <p>Este contrato se rige por el Código Civil, la LAU, el Real Decreto 1312/2024 y normativa aplicable.</p>

  <p style="text-align:center; margin-top: 3rem;">Firmado por duplicado en el lugar y fecha indicados.</p>

  <div class="signatures-container">
    <div class="signature-section">
      <p>LA PARTE ARRENDADORA:</p>
      <canvas height="200" id="firmaArrendadora" width="300"></canvas>
      <button class="clear-signature-btn" data-canvas-id="firmaArrendadora">Borrar Firma</button>
    </div>
    <div class="signature-section">
      <p>LA PARTE ARRENDATARIA:</p>
      <canvas height="200" id="firmaArrendataria" width="300"></canvas>
      <button class="clear-signature-btn" data-canvas-id="firmaArrendataria">Borrar Firma</button>
    </div>
  </div>
</div>
<div style="text-align: center; margin-top: 20px;">
  <button onclick="subirPDFaS3()">📤 Subir PDF a S3</button>
</div>
<div id="resultado" style="text-align: center; display: none; margin-top: 20px;">
  <input id="urlPdf" type="text" readonly style="width: 80%; padding: 8px;" />
  <button onclick="copiarLink()">📋 Copiar</button>
  <button onclick="compartirWhatsApp()">📲 WhatsApp</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
	
<script>



  // --- Signature Pad Logic ---
  const signaturePads = {};
  ['firmaArrendadora', 'firmaArrendataria'].forEach(id => {
    const canvas = document.getElementById(id);
    canvas.signaturePad = new SignaturePad(canvas, { backgroundColor: 'rgba(252, 252, 252, 1)' });
    signaturePads[id] = canvas.signaturePad;
  });
  document.querySelectorAll('.clear-signature-btn').forEach(button => {
    button.addEventListener('click', (event) => {
      const canvasId = event.target.dataset.canvasId;
      if (signaturePads[canvasId]) { signaturePads[canvasId].clear(); }
    });
  });
  // --- Logic para mostrar/ocultar el campo "Otros" ---
  const purposeRadios = document.querySelectorAll('input[name="purpose"]');
  const otrosDetailsInput = document.getElementById('purpose-otros-details');
  purposeRadios.forEach(radio => {
    radio.addEventListener('change', () => {
      if (document.getElementById('purpose-otros').checked) {
        otrosDetailsInput.style.display = 'inline-block';
      } else {
        otrosDetailsInput.style.display = 'none';
        otrosDetailsInput.value = '';
      }
    });
  });
	

  function resizeCanvas(canvas) {
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
  }
  function clearAndResize() {
      document.querySelectorAll('canvas').forEach(canvas => {
          if (canvas.signaturePad) {
            const data = canvas.signaturePad.toData();
            resizeCanvas(canvas);
            canvas.signaturePad.fromData(data);
          }
      });
  }
  window.addEventListener("resize", clearAndResize);
  document.querySelectorAll('canvas').forEach(resizeCanvas);

  // --- NUEVO SCRIPT: Lógica para impresión compatible con móviles ---
  window.addEventListener('beforeprint', () => {
    const checkedRadio = document.querySelector('input[name="purpose"]:checked');
    if (checkedRadio) {
      // Usamos el ID del radio para encontrar su etiqueta <label> asociada
      const label = document.querySelector(`label[for="${checkedRadio.id}"]`);
      if (label) {
        label.classList.add('selected-for-print');
      }
    }
  });

  window.addEventListener('afterprint', () => {
    // Buscamos la etiqueta que modificamos y le quitamos la clase
    const printedLabel = document.querySelector('.selected-for-print');
    if (printedLabel) {
      printedLabel.classList.remove('selected-for-print');
    }
  });

</script>


<script>

  AWS.config.region = 'eu-south-2';
  AWS.config.credentials = new AWS.CognitoIdentityCredentials({
    IdentityPoolId: 'eu-south-2:e70e5ae2-2635-4445-9bb6-abd20a1264b4'
  });
  function copiarLink() {
    const urlInput = document.getElementById('urlPdf');
    urlInput.select();
    document.execCommand('copy'); // Para compatibilidad amplia
    alert('📋 Enlace copiado al portapapeles');
  }
  function subirPDFaS3() {
    const element = document.getElementById('contrato');

    const options = {
      margin: 0.5,
      filename: 'contrato.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().from(element).set(options).outputPdf('blob').then(function (blob) {
      const guest = document.getElementById('guestname').value.trim().replace(/ /g, "_");
      const fileName = 'contrato-' + guest + Date.now() + '.pdf';

      const s3 = new AWS.S3({
        apiVersion: '2006-03-01',
        params: { Bucket: 'contratos-pdf-pablo' } // 👈 REEMPLAZAR
      });

      const params = {
        Key: fileName,
        ContentType: 'application/pdf',
        Body: blob,
      };

      s3.upload(params, function (err, data) {
        if (err) {
          console.error('❌ Error al subir:', err);
          alert("❌ Error al subir el PDF.");
        } else {
          console.log('✅ PDF subido a S3:', data.Location);

          const urlInput = document.getElementById('urlPdf');
          urlInput.value = data.Location;

          const resultado = document.getElementById('resultado');
          resultado.style.display = 'block';
        }
      });
    });
  }
  function compartirWhatsApp() {
    const url = document.getElementById('urlPdf').value;
    const mensaje = encodeURIComponent("📄 Aquí tienes el contrato:\n" + url);
    const enlace = `https://wa.me/?text=${mensaje}`;
    window.open(enlace, '_blank');
  }

  function abrirReserva() {
  const reserva = document.getElementById('reservaId').value.trim();
  if (!reserva) {
    alert("Introduce un número de reserva válido.");
    return;
  }
  const url = `https://www.airbnb.es/hosting/stay/${reserva}`;
  window.open(url, '_blank');
}
async function importarDesdeClipboard() {
  try {
    const texto = await navigator.clipboard.readText();
    const nombreMatch = texto.match(/👤 Inquilino:\s*(.+)/);
    const alojamientoMatch = texto.match(/🏠 Alojamiento:\s*(.+)/);
    const fechasMatch = texto.match(/📅 Fechas:\s*(.+)/);

    if (!nombreMatch || !alojamientoMatch || !fechasMatch) {
      alert("❌ No se encontraron datos válidos en el portapapeles.");
      return;
    }

    const nombre = nombreMatch[1];
    const alojamiento = alojamientoMatch[1];
    const fechas = fechasMatch[1];

    document.getElementById("guestname").value = nombre;
    document.getElementById("alojamiento").value = alojamiento;

    const fechasRegex = /(\d{1,2})\s(\w+)\s[–-]\s(\d{1,2})\s(\w+)/;
    const match = fechas.match(fechasRegex);
    if (match) {
      const diaInicio = match[1];
      const mesInicio = match[2];
      const diaFin = match[3];
      const mesFin = match[4];

      const meses = {
        "ene": "01", "feb": "02", "mar": "03", "abr": "04",
        "may": "05", "jun": "06", "jul": "07", "ago": "08",
        "sept": "09", "oct": "10", "nov": "11", "dic": "12"
      };

      const añoActual = new Date().getFullYear();

      const fechaInicio = `${añoActual}-${meses[mesInicio.toLowerCase().slice(0, 3)]}-${diaInicio.padStart(2, '0')}`;
      const fechaFin = `${añoActual}-${meses[mesFin.toLowerCase().slice(0, 3)]}-${diaFin.padStart(2, '0')}`;

      document.getElementById("fechaInicio").value = fechaInicio;
      document.getElementById("fechaFin").value = fechaFin;
    }

    alert("✅ Datos pegados desde el portapapeles");

  } catch (err) {
    console.error(err);
    alert("❌ Error al leer desde el portapapeles");
  }
}

</script>


</body>
</html>
