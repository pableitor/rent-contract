

<!DOCTYPE html>
<html lang="es" xml:lang="es" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Contrato de Alojamiento Temporal</title>
  <style type="text/css">
    /* --- ESTILOS PARA LA PANTALLA --- */
    :root {
      --primary-color: #005a9c;
      --secondary-color: #333;
      --light-gray: #f4f7f9;
      --border-color: #e0e0e0;
      --placeholder-bg: #eeeeee;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
      background-color: var(--light-gray);
      color: #444;
      line-height: 1.6;
      font-size: 11pt;
      padding: 2rem 1rem;
    }

    .contract-container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      padding: 3rem;
      border-radius: 8px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    }

    h1 { font-size: 1.8rem; font-weight: 700; color: var(--secondary-color); text-align: center; margin-bottom: 2.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; }
    h2 { font-size: 1.3rem; font-weight: 600; color: var(--primary-color); margin-top: 2.5rem; margin-bottom: 1rem; }
    h3 { font-size: 1.1rem; font-weight: 600; color: var(--secondary-color); margin-top: 2rem; margin-bottom: 0.8rem; }
    p { margin-bottom: 1.2rem; }
    p:last-child { margin-bottom: 0; }
    
    .party-info { background-color: var(--light-gray); padding: 1rem 1.5rem; border-left: 4px solid var(--primary-color); border-radius: 4px; margin-bottom: 1rem; }

    .placeholder {
      background-color: var(--placeholder-bg);
      padding: 0.2rem 0.5rem;
      border: 1px solid var(--border-color);
      border-radius: 4px;
      font-family: inherit;
      font-size: inherit;
    }
    input.placeholder {
        border: 1px solid #ccc;
        padding: 4px 8px;
    }
    input[type="text"].placeholder { min-width: 250px; }
    input[type="date"].placeholder { border: 1px solid #ccc; padding: 3px 8px; width: auto; }
    
    .full-width-input { width: 100%; }

    /* --- SECCIÓN DE FIRMAS --- */
    .signatures-container { display: flex; justify-content: space-around; gap: 2rem; flex-wrap: wrap; margin-top: 2rem; }
    .signature-section { display: flex; flex-direction: column; align-items: center; }
    .signature-section p { font-weight: 600; color: var(--secondary-color); margin-bottom: 0.5rem; }
    canvas { width: 300px; height: 200px; border: 2px dashed var(--border-color); border-radius: 8px; cursor: crosshair; background-color: #fcfcfc; }
    .clear-signature-btn { margin-top: 0.5rem; padding: 6px 12px; font-size: 0.8rem; color: #777; background-color: #f0f0f0; border: 1px solid #ddd; border-radius: 4px; cursor: pointer; transition: background-color 0.2s, color 0.2s; }
    .clear-signature-btn:hover { background-color: #e0e0e0; color: #333; }

    /* --- DROPDOWN --- */
    .dropdown { position: relative; width: 100%; }
    .dropdown-toggle { padding: 12px 15px; border: 1px solid var(--border-color); cursor: pointer; background-color: #fff; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; transition: border-color 0.2s; text-align: left; }
    .dropdown-toggle:hover { border-color: var(--primary-color); }
    .dropdown-toggle::after { content: '▼'; font-size: 0.8em; color: #888; margin-left: 10px; }
    .dropdown-menu { position: absolute; top: 100%; left: 0; right: 0; background: #fff; border: 1px solid var(--border-color); border-top: none; max-height: 250px; overflow-y: auto; display: none; z-index: 1000; border-radius: 0 0 6px 6px; box-shadow: 0 8px 10px rgba(0,0,0,0.1); }
    .dropdown-menu .option { padding: 12px 15px; border-bottom: 1px solid #f0f0f0; cursor: pointer; transition: background-color 0.2s; }
    .dropdown-menu .option:last-child { border-bottom: none; }
    .dropdown-menu .option:hover { background-color: var(--light-gray); }
    .direccion { font-weight: bold; color: var(--secondary-color); }
    .nrua { font-size: 0.85em; color: #666; margin-top: 4px; display: block; }
    
    /* --- PURPOSE LIST CON RADIO BUTTONS --- */
    .purpose-list { background-color: #f9f9f9; border: 1px solid var(--border-color); border-radius: 6px; padding: 1rem 1.5rem; }
    .purpose-option { display: flex; align-items: center; margin-bottom: 0.8rem; }
    .purpose-option:last-child { margin-bottom: 0; }
    .purpose-option input[type="radio"] { margin-right: 10px; transform: scale(1.1); }
    .purpose-option label { cursor: pointer; flex-grow: 1; }
    #purpose-otros-details { display: none; margin-left: 10px; }

    @media (max-width: 768px) {
        body { padding: 1rem 0.5rem; }
        .contract-container { padding: 1.5rem; }
        h1 { font-size: 1.5rem; }
        h2 { font-size: 1.2rem; }
    }
    
    @media print {
        body { font-size: 10pt; line-height: 1.3; padding: 0; background-color: #fff; color: #000; }
        .contract-container { max-width: 100%; padding: 0; box-shadow: none; border-radius: 0; margin: 0; }
        h1, h2, h3 { color: #000 !important; margin-top: 1.2em; margin-bottom: 0.6em; padding-bottom: 0.2em; }
        h1 { font-size: 15pt; }
        h2 { font-size: 12pt; }
        h3 { font-size: 11pt; border-bottom: 1px solid #ccc; }
        p { margin-bottom: 0.8em; }
        .party-info, .purpose-list { padding: 0.5em 0.8em; margin-bottom: 0.8em; background-color: #f0f0f0 !important; border: 1px solid #ddd; }
        
        .placeholder, input.placeholder {
            background-color: transparent !important;
            border: none;
            border-bottom: 1px solid #999;
            border-radius: 0;
            padding: 0 2px;
        }

        .dropdown-toggle { border: none; padding: 0; }
        .dropdown-toggle::after { display: none; }
        .signatures-container { page-break-inside: avoid; }
        canvas { border: 1px solid #333; }
        .clear-signature-btn { display: none !important; }
        
        input[type="date"] { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
        input[type="date"]::-webkit-inner-spin-button, input[type="date"]::-webkit-calendar-picker-indicator { display: none; }
        
        /* Ocultamos los radio buttons originales para que no salgan vacíos */
        input[type="radio"] { display: none; }

        /* NUEVA REGLA: Estilo para la etiqueta de la opción seleccionada */
        .selected-for-print {
            font-weight: bold;
            text-decoration: underline;
        }
        .selected-for-print::before {
            content: '(X) '; /* Añade un marcador visual extra */
        }
    }
  </style>
<script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
</script>
<script src="https://cdn.jsdelivr.net/npm/aws-sdk@2.1414.0/dist/aws-sdk.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
 <script type="text/javascript" src="html2canvas.js"></script>
</head>
<body>

<div class="contract-container" id="contrato">
  <h1>CONTRATO DE ARRENDAMIENTO DE ESTANCIAS TEMPORALES NO VACACIONALES</h1>
  <p style="text-align:right;">En Madrid, a <input type="date" class="placeholder" id="fechaContrato"></p>

  <h2>REUNIDOS</h2>
  <div class="party-info">
    <p>
      <strong>De una parte, D./D.ª Nina Dong</strong>, mayor de edad, con domicilio en Rd. Calabasa 11 , 28043 Madrid , y con NIF  05298495P , en adelante, la <strong>Parte Arrendadora</strong>.
    </p>
  </div>
  <div class="party-info">
    <p>
      <strong>Y de otra, D./D.ª <input type="text" class="placeholder" placeholder="Nombre y apellidos" maxlength="50"></strong>, mayor de edad, con domicilio en <input type="text" class="placeholder full-width-input" placeholder="Dirección completa" maxlength="100">, y con NIF/PASAPORTE <input type="text" class="placeholder" placeholder="NIF o Pasaporte" maxlength="25">, en adelante, la <strong>Parte Arrendataria</strong>.
    </p>
  </div>
  <p>Ambas partes, reconociéndose capacidad legal suficiente, acuerdan formalizar el presente contrato de arrendamiento de corta duración, con sujeción a las siguientes:</p>
  
  <h2>CLÁUSULAS</h2>
  
  <h3>Primera. Objeto del contrato</h3>
  <p>La Parte Arrendadora cede en arrendamiento a la Parte Arrendataria, quien acepta, la unidad de alojamiento ubicada en:</p>
  <div class="dropdown" id="alojDropdown">
    <div class="dropdown-toggle" id="selectedOption">Haz clic para seleccionar alojamiento</div>
    <div class="dropdown-menu" id="dropdownMenu">
      <div class="option" data-value="alcala-roja"><div class="direccion">C/ALCALA 281 1ºJ 28027 MADRID, HAB ROJA</div><span class="nrua">NRUA ESHFNT000028117000578623001000000000000000000000000007</span></div>
      <div class="option" data-value="alcala-verde"><div class="direccion">C/ALCALA 281 1ºJ 28027 MADRID, HAB VERDE</div><span class="nrua">NRUA ESHFNT00002811700057862300200000000000000000000000006</span></div>
      <div class="option" data-value="alcala-amarilla"><div class="direccion">C/ALCALA 281 1ºJ 28027 MADRID, HAB AMARILLA</div><span class="nrua">NRUA ESHFNT00002811700057862300300000000000000000000000005</span></div>
      <div class="option" data-value="vallejo-1"><div class="direccion">C/DOCTOR VALLEJO 35 2ºA 28027 MADRID, HAB 1</div><span class="nrua">NRUA ESHFNT00002811700042449400100000000000000000000000003</span></div>
      <div class="option" data-value="vallejo-2"><div class="direccion">C/DOCTOR VALLEJO 35 2ºA 28027 MADRID, HAB 2</div><span class="nrua">NRUA ESHFNT00002811700042449400200000000000000000000000002</span></div>
      <div class="option" data-value="vallejo-3"><div class="direccion">C/DOCTOR VALLEJO 35 2ºA 28027 MADRID, HAB 3</div><span class="nrua">NRUA ESHFNT00002811700042449400300000000000000000000000001</span></div>
      <div class="option" data-value="vallejo-4"><div class="direccion">C/DOCTOR VALLEJO 35 2ºA 28027 MADRID, HAB 4</div><span class="nrua">NRUA ESHFNT00002811700042449400400000000000000000000000000</span></div>
      <div class="option" data-value="vallejo-5"><div class="direccion">C/DOCTOR VALLEJO 35 2ºA 28027 MADRID, HAB 5</div><span class="nrua">NRUA ESHFNT00002811700042449400500000000000000000000000009</span></div>
    </div>
  </div>
  
  <h3>Segunda. Finalidad temporal del arrendamiento</h3>
  <p>El arrendamiento tiene carácter temporal y no permanente, destinado a:</p>
  <div class="purpose-list">
    <div class="purpose-option">
        <input type="radio" id="purpose-trabajo" name="purpose" value="Trabajo temporal"><label for="purpose-trabajo">Trabajo temporal</label>
    </div>
    <div class="purpose-option">
        <input type="radio" id="purpose-estudios" name="purpose" value="Estudios"><label for="purpose-estudios">Estudios</label>
    </div>
    <div class="purpose-option">
        <input type="radio" id="purpose-medico" name="purpose" value="Tratamiento médico"><label for="purpose-medico">Tratamiento médico</label>
    </div>
    <div class="purpose-option">
        <input type="radio" id="purpose-personal" name="purpose" value="Motivos personales / familiares"><label for="purpose-personal">Motivos personales / familiares</label>
    </div>
    <div class="purpose-option">
        <input type="radio" id="purpose-otros" name="purpose" value="Otros">
        <label for="purpose-otros">
            Otros
            <input type="text" id="purpose-otros-details" class="placeholder" placeholder="Especificar motivo" maxlength="50">
        </label>
    </div>
  </div>
  <p>Conforme al artículo 3 de la Ley de Arrendamientos Urbanos, este contrato no se rige por las disposiciones aplicables al arrendamiento de vivienda habitual.</p>
  
  <h3>Tercera. Duración</h3>
  <p>El presente contrato tendrá una duración desde el día <input type="date" class="placeholder" id="fechaInicio"> hasta el día <input type="date" class="placeholder" id="fechaFin">, sin posibilidad de prórroga tácita, salvo acuerdo expreso.</p>
  
  <h3>Cuarta. Renta y forma de pago</h3>
  <p>El precio del arrendamiento ha sido acordado y satisfecho íntegramente a través de la plataforma digital AIRBNB.</p>
  <p>Dicha plataforma incluye tasas e impuestos en la gestión del pago. Las partes reconocen haber aceptado las condiciones económicas en dicha plataforma.</p>
  
  <h3>Quinta. Fianza</h3>
  <p>Al tratarse del arrendamiento temporal de una habitación ubicada dentro de la vivienda habitual de la parte arrendadora, las partes acuerdan no establecer fianza alguna.</p>
  <p>Esta exención se realiza conforme al carácter temporal del arrendamiento y la naturaleza del uso compartido del inmueble, en ejercicio de la libertad contractual reconocida por la normativa civil vigente.</p>
  
  <h3>Sexta. Uso y conservación</h3>
  <p>El arrendatario usará el alojamiento exclusivamente como vivienda temporal, sin realizar actividades molestas o ilegales.</p>
  
  <h3>Séptima. Protección de datos personales</h3>
  <p>En cumplimiento del RGPD y LOPDGDD, se informa que los datos personales se tratarán para la gestión del arrendamiento y podrán comunicarse al Registro y la Ventanilla Única Digital. El arrendatario podrá ejercer sus derechos de protección de datos.</p>
  
  <h3>Octava. Legislación aplicable</h3>
  <p>Este contrato se rige por el Código Civil, la LAU, el Real Decreto 1312/2024 y normativa aplicable.</p>

  <p style="text-align:center; margin-top: 3rem;">Firmado por duplicado en el lugar y fecha indicados.</p>

  <div class="signatures-container">
    <div class="signature-section">
      <p>LA PARTE ARRENDADORA:</p>
      <canvas height="200" id="firmaArrendadora" width="300"></canvas>
      <button class="clear-signature-btn" data-canvas-id="firmaArrendadora">Borrar Firma</button>
    </div>
    <div class="signature-section">
      <p>LA PARTE ARRENDATARIA:</p>
      <canvas height="200" id="firmaArrendataria" width="300"></canvas>
      <button class="clear-signature-btn" data-canvas-id="firmaArrendataria">Borrar Firma</button>
    </div>
  </div>
</div>

<button onclick="subirPDFaS3()">📤 Subir PDF a S3</button>

<div id="resultado" style="text-align: center; display: none; margin-top: 20px;">
  <input id="urlPdf" type="text" readonly style="width: 80%; padding: 8px;" />
  <button onclick="copiarLink()">📋 Copiar</button>
  <button onclick="compartirWhatsApp()">📲 WhatsApp</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.6/dist/signature_pad.umd.min.js"></script>
	
<script>
  // --- Dropdown Logic ---
  const toggle = document.getElementById('selectedOption');
  const menu = document.getElementById('dropdownMenu');
  const options = document.querySelectorAll('.option');
  toggle.addEventListener('click', () => { menu.style.display = menu.style.display === 'block' ? 'none' : 'block'; });
  options.forEach(option => {
    option.addEventListener('click', () => {
      const direccion = option.querySelector('.direccion').textContent;
      const nrua = option.querySelector('.nrua').textContent;
      toggle.innerHTML = '<div><div class="direccion">' + direccion + '</div><span class="nrua">' + nrua + '</span></div>';
      menu.style.display = 'none';
    });
  });
  window.addEventListener('click', e => { if (!document.getElementById('alojDropdown').contains(e.target)) { menu.style.display = 'none'; } });

  // --- Signature Pad Logic ---
  const signaturePads = {};
  ['firmaArrendadora', 'firmaArrendataria'].forEach(id => {
    const canvas = document.getElementById(id);
    canvas.signaturePad = new SignaturePad(canvas, { backgroundColor: 'rgba(252, 252, 252, 1)' });
    signaturePads[id] = canvas.signaturePad;
  });
  document.querySelectorAll('.clear-signature-btn').forEach(button => {
    button.addEventListener('click', (event) => {
      const canvasId = event.target.dataset.canvasId;
      if (signaturePads[canvasId]) { signaturePads[canvasId].clear(); }
    });
  });
  // --- Logic para mostrar/ocultar el campo "Otros" ---
  const purposeRadios = document.querySelectorAll('input[name="purpose"]');
  const otrosDetailsInput = document.getElementById('purpose-otros-details');
  purposeRadios.forEach(radio => {
    radio.addEventListener('change', () => {
      if (document.getElementById('purpose-otros').checked) {
        otrosDetailsInput.style.display = 'inline-block';
      } else {
        otrosDetailsInput.style.display = 'none';
        otrosDetailsInput.value = '';
      }
    });
  });
	

  function resizeCanvas(canvas) {
    const ratio = Math.max(window.devicePixelRatio || 1, 1);
    canvas.width = canvas.offsetWidth * ratio;
    canvas.height = canvas.offsetHeight * ratio;
    canvas.getContext("2d").scale(ratio, ratio);
  }
  function clearAndResize() {
      document.querySelectorAll('canvas').forEach(canvas => {
          if (canvas.signaturePad) {
            const data = canvas.signaturePad.toData();
            resizeCanvas(canvas);
            canvas.signaturePad.fromData(data);
          }
      });
  }
  window.addEventListener("resize", clearAndResize);
  document.querySelectorAll('canvas').forEach(resizeCanvas);

  // --- NUEVO SCRIPT: Lógica para impresión compatible con móviles ---
  window.addEventListener('beforeprint', () => {
    const checkedRadio = document.querySelector('input[name="purpose"]:checked');
    if (checkedRadio) {
      // Usamos el ID del radio para encontrar su etiqueta <label> asociada
      const label = document.querySelector(`label[for="${checkedRadio.id}"]`);
      if (label) {
        label.classList.add('selected-for-print');
      }
    }
  });

  window.addEventListener('afterprint', () => {
    // Buscamos la etiqueta que modificamos y le quitamos la clase
    const printedLabel = document.querySelector('.selected-for-print');
    if (printedLabel) {
      printedLabel.classList.remove('selected-for-print');
    }
  });

</script>


<script>
  AWS.config.region = 'eu-south-2';
  AWS.config.credentials = new AWS.CognitoIdentityCredentials({
    IdentityPoolId: 'eu-south-2:e70e5ae2-2635-4445-9bb6-abd20a1264b4'
  });
  function copiarLink() {
    const urlInput = document.getElementById('urlPdf');
    urlInput.select();
    document.execCommand('copy'); // Para compatibilidad amplia
    alert('📋 Enlace copiado al portapapeles');
  }
  function subirPDFaS3() {
    const element = document.getElementById('contrato');

    const options = {
      margin: 0.5,
      filename: 'contrato.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().from(element).set(options).outputPdf('blob').then(function (blob) {
      const fileName = 'contrato-' + Date.now() + '.pdf';

      const s3 = new AWS.S3({
        apiVersion: '2006-03-01',
        params: { Bucket: 'contratos-pdf-pablo' } // 👈 REEMPLAZAR
      });

      const params = {
        Key: fileName,
        ContentType: 'application/pdf',
        Body: blob,
      };

      s3.upload(params, function (err, data) {
        if (err) {
          console.error('❌ Error al subir:', err);
          alert("❌ Error al subir el PDF.");
        } else {
          console.log('✅ PDF subido a S3:', data.Location);

          const urlInput = document.getElementById('urlPdf');
          urlInput.value = data.Location;

          const resultado = document.getElementById('resultado');
          resultado.style.display = 'block';
        }
      });
    });
  }
  function compartirWhatsApp() {
    const url = document.getElementById('urlPdf').value;
    const mensaje = encodeURIComponent("📄 Aquí tienes el contrato:\n" + url);
    const enlace = `https://wa.me/?text=${mensaje}`;
    window.open(enlace, '_blank');
  }
</script>


</body>
</html>
